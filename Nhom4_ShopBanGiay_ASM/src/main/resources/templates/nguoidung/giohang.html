<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">

<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CONVERSE || SẢN PHẨM</title>
<!-- Bootstrap CSS -->
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x"
	crossorigin="anonymous">
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css"
	integrity="sha512-tS3S5qG0BlhnQROyJXvNjeEM4UpMXHrQfTGmbQ1gKmelCxlSEBUaxhRBj/EFTzpbP4RVSrpEikbmdJobCvhE3g=="
	crossorigin="anonymous" />
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.theme.default.min.css"
	integrity="sha512-sMXtMNL1zRzolHYKEujM2AqCLUR9F2C4/05cdbxjjLSRvMQIciEPCQZo++nk7go3BtSuK9kfa/s+a4f4i5pLkw=="
	crossorigin="anonymous" />
<link th:href="@{/css/mycss.css}" rel="stylesheet" />
<link th:href="@{/font/themify-icons/themify-icons.css}"
	rel="stylesheet" />

</head>

<body>
	<!-- header start -->
	<div th:replace="~{/layout/user_menu::user_menu}"></div>
	<!-- header end -->

	<!-- mainCart start -->
 <div id="mainCart" th:if="${#lists.size(carts)}">
        <div class="myTable mt-5 mb-5">
            <table class="table table-hover table-size">
                <thead>
                    <tr>
                        <th></th>
                        <th>Hình</th>
                        <th>Tên</th>
                        <th>Size</th>
                        <th>Giá</th>
                        <th>Số lượng</th>
                        <th>Tạm tính</th>
                    </tr>
                </thead>
                <tbody>
                    <tr id="table" th:each="cart: ${carts}">
                        <td ><span class="ti-close"></span></td>
                        <td ><img th:src="@{./imageSP/{img}(img=${cart.sanphamsize.sanpham.hinhanh3})}" ></td>
                        <td th:text="${cart.sanphamsize.sanpham.tensp}">Chuck 70s High AllWhite</td>
                        <td th:text="${cart.sanphamsize.size.sizegiay}"></td>
                        <td th:text="${cart.sanphamsize.sanpham.giamgiasp}">950.000đ</td>
                        <td>
                            
                            <div th:replace="~{/layout/quantitycontrol :: quantitycontrol(${cart.soluong},${cart.sanphamsize.masps})}"></div>
                            
                        </td>
                        <td class="subtotal" th:id="'total'+${cart.sanphamsize.masps}" >[[${cart.subtotal}]]</td>
                    </tr>
                   	
                </tbody>
            </table>
        </div>
        


        <div class="tongCart m-5" >

            <div class="row">
                <div class="col-md-6"></div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h3>CỘNG GIỎ HÀNG</h3>
                        </div>
                        <div class="card-body">
                            <table class="table table-hover text-center table-size">
                                <tr>
                                    <td>
                                        <h6>Tạm tính</h6>
                                    </td>
                                    <td>950.000đ</td>
                                </tr>
                                <tr>
                                    <td>
                                        <h6>Giảm giá</h6>
                                    </tD>
                                    <td>0đ</td>
                                </tr>
                                <tr>
                                    <th>TỔNG</th>
                                    <th><span class="totalAmount">[[${totalAmount}]]</span></th>
                                </tr>
                            </table>
                        </div>
                        <div class="card-footer">
                            <a th:href="@{/thongtindonhang}" class="btn btn-cart btn-btn"> TIẾN HÀNH THANH TOÁN</a>
                        </div>
                    </div>
                </div>
            </div>

        </div>
        	
        
    </div>
    <div th:if="${#lists.size(carts)==0}" id="noCart" class="container" align="center"
		style="display: flex; justify-content: center; align-items: center; min-height: 50vh;">
		<div><img alt="" th:src="@{./images/lol.jpg}" width="40%">
		<h3 class="my-4">Ôi không giỏ giỏ hàng bị hack trống rổng rồi</h3>
		 <a th:href="@{/trangchu}" class="btn btn-danger"> QUAY DỀ MUA HÀNG</a>
		
		</div>
	</div>
	<!-- mainCart end -->


	<!-- FOOTER -->
	<footer class="text-center text-lg-start bg-light text-muted">
		<section class="">
			<div class="container-fluid text-justify text-md-start mt-5">
				<div class="row mt-3">
					<div class="col-md-3 col-lg-4 col-xl-3 mx-auto mb-4">
						<p
							style="text-indent: 30px; text-align: justify; margin-top: 37px; font-size: 17px;">
							Tìm thấy câu trả lời cho độ bền không giới hạn mà CONVERSE luôn
							hướng tới để tiếp tục phát triển bền bỉ.Đó là lý tưởng của sự
							mạnh mẽ, chức năng và khả năng hoạt động tốt kết hợp với độ cứng
							cáp tuyệt đối.Lý tưởng này là nguồn gốc của độ cứng cáp mà
							CONVERSE luôn tìm kiếm.</p>
					</div>

					<div class="col-md-2 col-lg-2 col-xl-2 mx-auto mb-4">
						<h4 class="text-uppercase fw-bold mb-4">CỬA HÀNG TẠI HÀ NỘI</h4>
						<p class="fs-17">187 Phố Vọng, Hai Bà Trưng, Hà Nội.</p>
						<p class="fs-17">187 Phố Vọng-Quân Hai Bà Trưng-Hà Nội.</p>
						<p class="fs-17">82 Cầu Giấy, Quan Hoa, Cầu Giấy.</p>
					</div>

					<div class="col-md-3 col-lg-2 col-xl-2 mx-auto mb-4">
						<h4 class="text-uppercase fw-bold mb-4">CỬA HÀNG TẠI TP.HCM</h4>
						<p class="fs-17">497 Hoàng Văn Thụ, Phường 4, Q. Tân Bình,
							TP.HCM.</p>
						<p class="fs-17">676 Lê Trọng Tấn, P. Bình Hưng Hòa, Q. Bình
							Tân, HCM.</p>
						<p class="fs-17">20 đường 3 tháng 2, Phường 12, Quận 10,
							TPHCM.</p>
					</div>

					<div class="col-md-4 col-lg-3 col-xl-3 mx-auto mb-md-0 mb-4">
						<h4 class="text-uppercase fw-bold mb-4">LIÊN LẠC</h4>
						<p class="fs-17">CONVERSEvietnam.net@gmail.com</p>
						<p class="fs-17">0105517236</p>
					</div>
				</div>
			</div>
		</section>

		<div class="text-center p-4 fs-17"
			style="background-color: rgba(0, 0, 0, 0.05)">
			© 2023 Copyright: <a class="text-reset fw-bold"
				href="https://conversestore.vn/">Converse.Store_</a>
		</div>
	</footer>
	<button type="button" class="btn btn-primary btn-floating btn-lg"
		id="btn-back-to-top">
		<i class="ti-angle-double-up"></i>
	</button>


	<script
		src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

	<!-- Option 1: Bootstrap Bundle with Popper -->
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4"
		crossorigin="anonymous"></script>
	<script
		src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"
		integrity="sha512-bPs7Ae6pVvhOSiIcyUClR7/q2OAsRiovw4vAkX+zJbw3ShAeeqezq50RIIcIURq7Oa20rW2n2q+fyXBNcU9lrw=="
		crossorigin="anonymous"></script>

	
	<!-- CAP NHAT TONG TIEN  -->
	<script type="text/javascript">
		contextPath="[[@{/}]]";
		
	</script>
<script type="text/javascript">
		$(document).ready(function() {
			
			$(document).ready(function() {
				//nut "-"
				$(".minusButton").on("click", function(evt) {
					evt.preventDefault();//khong chuyen huong trinh duyet
					minus($(this))
				})

				//nut "+"
				$(".plusButton").on("click", function(evt) {
					evt.preventDefault();//khong chuyen huong trinh duyet
					plus($(this))
				})
			})
			updateTotal();
			
		})
		function minus(link) {
			masps = link.attr("pid");//lay gia trị cua th:pid
    		qtyInput = $("#quantity" + masps);
    								 
    								  //value
    		newQty = parseInt(qtyInput.val())-1;
    		if (newQty >0){
    				qtyInput.val(newQty)
    				updateQty(masps,newQty)
    			} ;
		}
		
		function plus(link) {
			masps = link.attr("pid");//lay gia trị cua th:pid
    		qtyInput = $("#quantity" + masps);
    								 
    								  //value
    		newQty = parseInt(qtyInput.val())+1;
    		if (newQty >0){
    				qtyInput.val(newQty)
    				updateQty(masps,newQty)
    			} ;
		}
		
		function updateQty(masps,qty){
			
			url= contextPath + "updateqty/" + masps +"/"+ qty;
			
			$.ajax({
				type: "POST",
				url: url,
				data: JSON.stringify(masps,newQty),
	              contentType: "application/json",

            	success: function (newSubtotal) {
                console.log(newSubtotal);

                $("#total" + masps).text(newSubtotal);
                updateTotal()
            },
				
			})
		}
	
		 /* function updateSubtotal(newSubtotal, masps){
			$("#total" + masps).text(newSubtotal);
		}  */
		function updateTotal() {
			var total = 0.0;
			console.log(total)
			$(".subtotal").each(function(index, element){
										//[[${cart.subtotal}]]
				total=total + parseFloat(element.innerHTML) 
			})
			
			$(".totalAmount").text(total);
			 
		}
	</script> 
	


</body>

	<!-- <script type="text/javascript">
		$('#qty').on('chage', function() {
			$.ajax({
				type : 'post',
				url : '/save',
				data : $('#table').serialize(),
				/* 	contentType: "application/json", */
				success : function(response) {
					$('#total').textContent = response.gia * reponse.soluong
				},
				error : function() {
					alert('error')
				}
			})
		})
	</script> -->
	<script>
		$('.owl-carousel').owlCarousel({
			loop : true,
			margin : 15,
			nav : true,
			responsive : {
				0 : {
					items : 1
				},
				600 : {
					items : 2
				},
				1000 : {
					items : 4
				}
			}
		})
	</script>

	<script>
		let mybutton = document.getElementById("btn-back-to-top");
		window.onscroll = function() {
			scrollFunction();
		};

		function scrollFunction() {
			if (document.body.scrollTop > 20
					|| document.documentElement.scrollTop > 20) {
				mybutton.style.display = "block";
			} else {
				mybutton.style.display = "none";
			}
		}
		mybutton.addEventListener("click", backToTop);

		function backToTop() {
			document.body.scrollTop = 0;
			document.documentElement.scrollTop = 0;
		}
	</script>

</html>